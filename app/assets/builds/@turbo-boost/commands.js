var ue=Object.defineProperty,le=Object.defineProperties;var fe=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var K=(e,t,r)=>t in e?ue(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,s=(e,t)=>{for(var r in t||(t={}))pe.call(t,r)&&K(e,r,t[r]);if(X)for(var r of X(t))be.call(t,r)&&K(e,r,t[r]);return e},p=(e,t)=>le(e,fe(t));var ge="TurboBoost-Command",y={boost:"text/vnd.turbo-boost.html",stream:"text/vnd.turbo-stream.html",html:"text/html",xhtml:"application/xhtml+xml",json:"application/json"},he=(e={})=>{e=s({},e);let t=(e.Accept||"").split(",").map(r=>r.trim()).filter(r=>r.length);return t.unshift(y.boost,y.stream,y.html,y.xhtml),e.Accept=[...new Set(t)].join(", "),e["Content-Type"]=y.json,e["X-Requested-With"]="XMLHttpRequest",e},ve=e=>{if(e){let[t,r,o]=e.split(", ");return{name:t,status:r,strategy:o}}return{}},f={prepare:he,tokenize:ve,RESPONSE_HEADER:ge};var ye={frameAttribute:"data-turbo-frame",methodAttribute:"data-turbo-method",commandAttribute:"data-turbo-command",confirmAttribute:"data-turbo-confirm",stateAttributesAttribute:"data-turbo-boost-state-attributes"},d=s({},ye);function Ee(e){return e.closest(`[${d.commandAttribute}]`)}function Ae(e){return e.closest("turbo-frame[src]")||e.closest("turbo-frame[data-turbo-frame-src]")||e.closest("turbo-frame")}function Se(e,t={}){if(e.tagName.toLowerCase()!=="select")return t.value=e.value||null;if(!e.multiple)return t.value=e.options[e.selectedIndex].value;t.values=Array.from(e.options).reduce((r,o)=>(o.selected&&r.push(o.value),r),[])}function xe(e){let t=Array.from(e.attributes).reduce((r,o)=>{let n=o.value;return r[o.name]=n,r},{});return t.tag=e.tagName,t.checked=!!e.checked,t.disabled=!!e.disabled,Se(e,t),delete t.class,delete t.action,delete t.href,delete t[d.commandAttribute],delete t[d.frameAttribute],t}var E={buildAttributePayload:xe,findClosestCommand:Ee,findClosestFrameWithSource:Ae};var ke=(e,t)=>{var r=new DOMParser,o=r.parseFromString(e,"text/html"),n=o.getElementById(t);return n.outerHTML},Ce=(e,t)=>{var n,i;let r=ke(e,t),o=document.querySelector(`#${t}`);o&&r&&((i=(n=TurboBoost==null?void 0:TurboBoost.Streams)==null?void 0:n.morph)==null||i.method(o,r))},we=e=>{document.body.insertAdjacentHTML("beforeend",e)},Le=e=>{var h,k,v,C;let r=new DOMParser().parseFromString(e,"text/html"),o=document.querySelector("head"),n=document.querySelector("body"),i=r.querySelector("head"),c=r.querySelector("body");o&&i&&((k=(h=TurboBoost==null?void 0:TurboBoost.Streams)==null?void 0:h.morph)==null||k.method(o,i)),n&&c&&((C=(v=TurboBoost==null?void 0:TurboBoost.Streams)==null?void 0:v.morph)==null||C.method(n,c))},w=(e,t,r)=>{if(e&&t){if(e.match(/^Append$/i))return we(t);if(e.match(/^Replace$/i))return Le(t);if(e.match(/^FrameReplace$/i))return Ce(t,r)}};var I={};addEventListener("turbo:before-fetch-response",e=>{let t=e.target.closest("turbo-frame");t!=null&&t.id&&(t!=null&&t.src)&&(I[t.id]=t.src);let{fetchResponse:r}=e.detail,o=r.header(f.RESPONSE_HEADER);if(!o)return;e.preventDefault();let{strategy:n}=f.tokenize(o);r.responseHTML.then(i=>w(n,i))});addEventListener("turbo:frame-load",e=>{let t=e.target.closest("turbo-frame");t.dataset.src=I[t.id]||t.src||t.dataset.src,delete I[t.id]});var a={start:"turbo-boost:command:start",success:"turbo-boost:command:success",finish:"turbo-boost:command:finish",abort:"turbo-boost:command:abort",clientError:"turbo-boost:command:client-error",serverError:"turbo-boost:command:server-error"},A={stateChange:"turbo-boost:state:change",stateInitialize:"turbo-boost:state:initialize"};function m(e,t,r={}){return new Promise(o=>{r=r||{},r.detail=r.detail||{},t=t||document;let n=new CustomEvent(e,p(s({},r),{bubbles:!0}));t.dispatchEvent(n),o(n)})}var L={};function Oe(e){L[e.id]=e}function Te(e){delete L[e]}var O={add:Oe,remove:Te,get commands(){return[...Object.values(L)]},get length(){return Object.keys(L).length}};var G={method:e=>Promise.resolve(confirm(e))},Re=e=>e.detail.driver==="method",$e=e=>{if(e.detail.driver!=="form")return!1;let t=e.target,r=t.closest("turbo-frame"),o=t.closest(`[${d.frameAttribute}]`);return!!(r||o)},Pe=e=>Re(e)||$e(e);document.addEventListener(a.start,async e=>{let t=e.target.getAttribute(d.confirmAttribute);if(!t||(e.detail.confirmation=!0,Pe(e)))return;await G.method(t)||e.preventDefault()});var Q=G;var l=[],N;function _e(e,t){let r=l.find(o=>o.name===e);return r&&l.splice(l.indexOf(r),1),l=[{name:e,selectors:t},...l],document.removeEventListener(e,N,!0),document.addEventListener(e,N,!0),s({},l.find(o=>o.name===e))}function De(e){return l.find(t=>t.selectors.find(r=>Array.from(document.querySelectorAll(r)).find(o=>o===e)))}function Be(e,t){let r=De(t);return r&&r.name===e}var u={register:_e,isRegisteredForElement:Be,get events(){return[...l]},set handler(e){N=e}};var Ie=(e,t={})=>{let r=e.querySelector('input[name="turbo_boost_command"]')||document.createElement("input");r.type="hidden",r.name="turbo_boost_command",r.value=JSON.stringify(t),e.contains(r)||e.appendChild(r)},Y={invokeCommand:Ie};function Ne(e){setTimeout(()=>m(a.finish,e.target,{detail:e.detail}))}var qe=[a.abort,a.serverError,a.success];qe.forEach(e=>addEventListener(e,Ne));addEventListener(a.finish,e=>O.remove(e.detail.id),!0);var Z={events:a};var Fe=e=>{let t=document.createElement("a");return t.href=e,new URL(t)},ee={get commandInvocationURL(){return Fe("/turbo-boost-command-invocation")}};var te=e=>{let t=`Unexpected error performing a TurboBoost Command! ${e.message}`;m(Z.events.clientError,document,{detail:{message:t,error:e}},!0)},je=e=>t=>{let{strategy:r}=f.tokenize(t.headers.get(f.RESPONSE_HEADER));t.text().then(o=>w(r,o,e))},T=(e={})=>{try{fetch(ee.commandInvocationURL.href,{method:"POST",headers:f.prepare({}),body:JSON.stringify(e)}).then(je(e.frameId)).catch(te)}catch(t){te(t)}};var ze=(e,t)=>T(t),q={invokeCommand:ze};var S,F,Me=()=>{S=null,F=null},He=(e,t={})=>{S=e,F=t},Je=e=>{try{if(!S||e.getAttribute("method")!==S.dataset.turboMethod||e.getAttribute("action")!==S.href)return;let t=e.querySelector('input[name="turbo_boost_command"]')||document.createElement("input");t.type="hidden",t.name="turbo_boost_command",t.value=JSON.stringify(F),e.contains(t)||e.appendChild(t)}finally{Me()}};document.addEventListener("submit",e=>Je(e.target),!0);var re={invokeCommand:He};var Ue=(e,t={})=>T(t),oe={invokeCommand:Ue};function j(e,t){return t=t||{dataset:{}},e.href||t.src||t.dataset.src||location.href}function Ve(e){let t=E.findClosestFrameWithSource(e),{turboFrame:r,turboMethod:o}=e.dataset;return e.tagName.toLowerCase()==="form"?{name:"form",reason:"Element is a form.",frame:t,src:e.action,invokeCommand:Y.invokeCommand}:o!=null&&o.length?{name:"method",reason:"Element defines data-turbo-method.",frame:t,src:e.href,invokeCommand:re.invokeCommand}:r&&r!=="_self"?(t=document.getElementById(r),{name:"frame",reason:"element targets a frame that is not _self",frame:t,src:j(e,t),invokeCommand:q.invokeCommand}):(!r||r==="_self")&&t?{name:"frame",reason:"element does NOT target a frame or targets _self and is contained by a frame",frame:t,src:j(e,t),invokeCommand:q.invokeCommand}:{name:"window",reason:"element matches one or more of the following conditions (targets _top, does NOT target a frame, is NOT contained by a frame)",frame:null,src:j(e),invokeCommand:oe.invokeCommand}}var z={find:Ve};var $="unknown",ne=!1,R=[],b={debug:Object.values(a),info:Object.values(a),warn:[a.abort,a.clientError,a.serverError],error:[a.clientError,a.serverError],unknown:[]},We=e=>{if(!b[$].includes(e.type)||typeof console[$]!="function")return!1;let{detail:t}=e;if(!t.id)return!0;let r=`${e.type}-${t.id}`;return R.includes(r)?!1:(R.length>16&&R.shift(),R.push(r),!0)},Xe=e=>b.error.includes(e.type)?"error":b.warn.includes(e.type)?"warn":b.info.includes(e.type)?"info":b.debug.includes(e.type)?"debug":"log",Ke=e=>{if(We(e)){let{target:t,type:r,detail:o}=e,n=o.id||"",i=o.name||"",c="";o.startedAt&&(c=`${Date.now()-o.startedAt}ms `);let h=r.split(":"),k=h.pop(),v=`%c${h.join(":")}:%c${k}`,C=[`%c${i}`,`%c${c}`,v];console[Xe(e)](C.join(" ").replace(/\s{2,}/g," "),"color:deepskyblue","color:lime","color:darkgray",v.match(/abort|error/i)?"color:red":"color:deepskyblue",{id:n,detail:o,target:t})}};ne||(ne=!0,Object.values(a).forEach(e=>addEventListener(e,t=>Ke(t))));var ae={get level(){return $},set level(e){return Object.keys(b).includes(e)||(e="unknown"),$=e}};var M;function P(e,t=null){if(!e||typeof e!="object")return e;let r=new Proxy(e,{deleteProperty(o,n){return delete o[n],m(A.stateChange,document,{detail:{state:M}}),!0},set(o,n,i,c){return o[n]=P(i,this),m(A.stateChange,document,{detail:{state:M}}),!0}});if(Array.isArray(e))e.forEach((o,n)=>e[n]=P(o,r));else if(typeof e=="object")for(let[o,n]of Object.entries(e))e[o]=P(n,r);return t||(M=r),r}var H=P;var se=(e,t,r,o=1)=>{if(o>20)return;let n=document.getElementById(e);if(n!=null&&n.isConnected)return n.setAttribute(t,r);setTimeout(()=>se(e,t,r,o+1),o*5)},Ge=()=>Array.from(document.querySelectorAll(`[id][${d.stateAttributesAttribute}]`)).reduce((t,r)=>{let o=JSON.parse(r.getAttribute(d.stateAttributesAttribute));if(r.id){let n=o.reduce((i,c)=>(r.hasAttribute(c)&&(i[c]=r.getAttribute(c)||c),i),{});Object.values(n).length&&(t[r.id]=n)}return t},{}),Qe=(e={})=>{for(let[t,r]of Object.entries(e))for(let[o,n]of Object.entries(r))se(t,o,n)},_={buildState:Ge,restoreState:Qe};function Ye(e,t){return typeof t!="object"&&(t={}),localStorage.setItem(String(e),JSON.stringify(t))}function Ze(e){let t=localStorage.getItem(String(e));return t?JSON.parse(t):{}}var D={save:Ye,find:Ze};var J="TurboBoost::State",U={pages:{},signed:null,unsigned:{}},B=null,x={},V=()=>{let e=s(s({},U),D.find(J));B=e.signed,x=H(e.unsigned),e.pages[location.pathname]=e.pages[location.pathname]||{},_.restoreState(e.pages[location.pathname])},W=()=>{let e=s(s({},U),D.find(J)),t={signed:B||e.signed,unsigned:s(s({},e.unsigned),x),pages:s({},e.pages)},r=location.pathname,o=_.buildState();Object.values(o).length?t.pages[r]=o:delete t.pages[r],D.save(J,t)},et=e=>{let t=s(s({},U),JSON.parse(e));B=t.signed,x=H(t.unsigned),W(),m(A.stateInitialize,document,{detail:x})};addEventListener("DOMContentLoaded",V);addEventListener("turbo:morph",V);addEventListener("turbo:render",V);addEventListener("turbo:before-fetch-request",W);addEventListener("beforeunload",W);var g={initialize:et,buildPageState:_.buildState,get signed(){return B},get unsigned(){return x}};function tt(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}var ie={v4:tt};var de="0.3.2";var rt=self.TurboBoost||{},me={VERSION:de,active:!1,confirmation:Q,logger:ae,schema:d,events:a,registerEventDelegate:u.register,get eventDelegates(){return u.events}};function ce(e,t){var r;return{csrfToken:(r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"),id:e,name:t.getAttribute(d.commandAttribute),elementId:t.id.length?t.id:null,elementAttributes:E.buildAttributePayload(t),startedAt:Date.now(),state:{page:g.buildPageState(),signed:g.signed,unsigned:g.unsigned}}}async function ot(e){let t,r={};try{if(t=E.findClosestCommand(e.target),!t||!u.isRegisteredForElement(e.type,t))return;let o=ie.v4(),n=z.find(t),i=p(s({},ce(o,t)),{driver:n.name,frameId:n.frame?n.frame.id:null,src:n.src}),c=await m(a.start,t,{cancelable:!0,detail:i});if(c.defaultPrevented||c.detail.confirmation&&e.defaultPrevented)return m(a.abort,t,{detail:{message:`An event handler for '${a.start}' prevented default behavior and blocked command invocation!`,source:c}});switch(n=z.find(t),i=p(s({},ce(o,t)),{driver:n.name,frameId:n.frame?n.frame.id:null,src:n.src}),O.add(i),["frame","window"].includes(n.name)&&e.preventDefault(),n.name){case"method":return n.invokeCommand(t,i);case"form":return n.invokeCommand(t,i,e);case"frame":return n.invokeCommand(n.frame,i);case"window":return n.invokeCommand(self,i)}}catch(o){m(a.clientError,t,{detail:p(s({},r),{error:o})})}}self.TurboBoost=s({},rt);self.TurboBoost.Commands||(u.handler=ot,u.register("click",[`[${d.commandAttribute}]`]),u.register("submit",[`form[${d.commandAttribute}]`]),u.register("toggle",[`details[${d.commandAttribute}]`]),u.register("change",[`input[${d.commandAttribute}]`,`select[${d.commandAttribute}]`,`textarea[${d.commandAttribute}]`]),self.TurboBoost.Commands=me,self.TurboBoost.State={initialize:g.initialize,get current(){return g.unsigned}});var Er=me;export{Er as default};
//# sourceMappingURL=commands.js.map
